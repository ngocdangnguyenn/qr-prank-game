<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đang Tải...</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-element cloud cloud1"></div>
    <div class="game-element cloud cloud2"></div>
    <div class="game-element cloud cloud3"></div>
    <div class="game-element block block1"></div>
    <div class="game-element block block2"></div>
    <div class="game-element coin coin1"></div>
    <div class="game-element coin coin2"></div>
    <div class="game-element coin coin3"></div>

    <div class="container">
        <div class="card loading-card">
            <div class="loading-content">
                <div class="svg-loader">
                    <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#00FF00"/>
                                <stop offset="100%" stop-color="#00FFFF"/>
                            </linearGradient>
                        </defs>
                        <circle cx="50" cy="50" r="40" fill="none" stroke="url(#grad1)" stroke-width="8" stroke-linecap="round" stroke-dasharray="60 80">
                            <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1.4s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="50" cy="50" r="30" fill="#00FF00" opacity="0.2">
                            <animate attributeName="r" values="28;34;28" dur="1.4s" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                </div>

                <h1 id="loadingText">Trò chơi đang tải...</h1>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <p class="hint-text" id="hintText">Đang chuẩn bị trò chơi cho bạn...</p>
            </div>
        </div>
    </div>

    <script>
        let refreshCount = parseInt(sessionStorage.getItem('refreshCount') || '0');
        const currentPlayer = sessionStorage.getItem('currentPlayer');
        if (!currentPlayer) {
            window.location.href = 'index.html';
        }
        refreshCount++;
        sessionStorage.setItem('refreshCount', refreshCount.toString());
        
        let progress = 0;
        const progressFill = document.getElementById('progressFill');
        const loadingText = document.getElementById('loadingText');
        const hintText = document.getElementById('hintText');
        
        const progressInterval = setInterval(() => {
            if (progress < 85) {
                progress += 0.5;
            } else if (progress < 95) {
                progress += 0.15;
            } else if (progress < 98) {
                progress += 0.05;
            }
            
            progressFill.style.width = progress + '%';
            
            if (progress >= 98 && refreshCount < 3) {
                clearInterval(progressInterval);
                loadingText.textContent = 'Gần xong rồi...';
                hintText.innerHTML = '<strong>Chà...Có vẻ như kết nối mạng yếu...</strong>';
            } else if (progress >= 98 && refreshCount >= 3) {
                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                setTimeout(() => {
                    window.location.href = 'result.html';
                }, 800);
            }
        }, 50);
    </script>
</body>
</html>
